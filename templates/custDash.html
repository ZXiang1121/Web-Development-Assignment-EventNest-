{% extends "base.html" %}
{% block title%}custDash{% endblock %}

{% block content %}
<body class="app">   	
    <div class="app-wrapper">
	    
	    <div class="app-content pt-3 p-md-3">
		    <div class="container-xl">
			    
			    <h1 class="app-page-title mb-2">Overview</h1>
				<div class="col-12 g-4 mb-4">
					<div class="app-card app-card-chart h-100 shadow-sm">
						<div class="app-card-header p-3">
							<div class="row justify-content-between align-items-center">
								<div class="col-auto">
									<h4 class="app-card-title">Line Chart Example</h4>
								</div><!--//col-->
								<div class="col-auto">
									<div class="card-header-action">
										<div class="mb-2 d-flex">   
											<select class="form-select form-select-sm ms-auto d-inline-flex w-auto">
												<option value="1" selected>This week</option>
												<option value="2">Today</option>
												<option value="3">This Month</option>
												<option value="3">This Year</option>
											</select>
										</div>
									</div><!--//card-header-actions-->
								</div><!--//col-->
							</div><!--//row-->
								<h2>$ {{200 + users_list | sum(attribute='price') }}</h2>
						</div><!--//app-card-header-->
						<div class="app-card-body p-3 p-lg-4">

							<div class="chart-container">
								<canvas style="max-height:250px;" id="myChart"></canvas>
								<script>

const data = {
      labels: [{% for item in labels %} "{{item}}",{% endfor %}], 
      datasets: [{
        label: '{{ legend }}',
        data: [{% for item in values %} {{item}} ,{% endfor %}],
        backgroundColor: [
          '	#FFF8DC',
        ],
        borderColor: [
          '#00FFFF',
        ],
        borderWidth: 3,
		pointRadius:3,
		yAxisID:'{{ legend }}'
      },
	]
    };

    // config
    const config = {
      type: 'line',
      data,
	  options: {
		plugins:{
		legend:{
			display:false
		}
	},
       scales: {
		'{{ legend }}':{
		beginAtZero:true,
		type:'linear',
		ticks:{
			stepSize:10
		},
		title:{
			display:true,
			text:'Total number of Users'
		},
		position:'left',
		grid:{
			display:false
		}
		},
       }
    }
};

    // render init block
      const ctx = document.getElementById('myChart');
      const myChart = new Chart(
      ctx,
      config
    );

		newData = [{% for item in new %} {{item}} ,{% endfor %}]
		gddata = [{% for item in BarVal %} {{item}} ,{% endfor %}]
		myChart.update()

    </script>
							</div>
						</div><!--//app-card-body-->
					</div><!--//app-card-->
				</div><!--//col-->
				    
			    <div class="row g-3 mb-4">
				    <div class="col-12 col-sm-6 col-xl-4 mb-4">
					    <div class="app-card app-card-stat shadow-sm h-70">
						    <div class="app-card-body p-3 p-lg-4">
							    <h4 class="stats-type mb-1">Tickets Bought</h4>
								<div class="chart-container">
									<div class="stats-figure py-4">
										<div class="stats-figure py-4">	
                      <h2>{{200 + users_list | count }}</h2>

				</div>
									</div>
								</div>
						    </div><!--//app-card-body-->
						    <a class="app-card-link-mask" href="#"></a>
					    </div><!--//app-card-->
				    </div><!--//col-->
				    
				    <div class="col-12 col-sm-3 col-md-4 mb-4">
					    <div class="app-card app-card-stat shadow-sm h-70">
						    <div class="app-card-body p-3 p-lg-4">
							    <h4 class="stats-type mb-1">Expenses</h4>
							    <div class="stats-figure py-4">	
									<h2>$ {{200 + users_list | sum(attribute='price') }}</h2>
								</div>
						    </div><!--//app-card-body-->
						    <a class="app-card-link-mask" href="#"></a>
					    </div><!--//app-card-->
				    </div><!--//col-->
				    <div class="col-12 col-sm-3 col-md-4 mb-4">
					    <div class="app-card app-card-stat shadow-sm h-100">
						    <div class="app-card-body p-3 p-lg-4">
							    <h4 class="stats-type">Projects</h4>
						    </div><!--//app-card-body-->
                            <div class="chart-container">
								<canvas style="max-height:80px" id="myChart1"></canvas>
								<script>
 const data2 = {
      labels: ['Music', 'Sports'],
      datasets: [{
        label: 'Weekly Sales',
        data: [3,3],
        backgroundColor: [
          'rgba(255, 26, 104, 0.2)',
          'rgba(255, 159, 64, 0.2)'
        ],
        borderColor: [
          'rgba(255, 26, 104, 1)',
          'rgba(255, 159, 64, 1)'
        ],
        borderWidth: 1
      }]
    };

    // config
    const config2 = {
      type: 'doughnut',
      data:data2,
	  options: {
		plugins:{
       legend:{
        position:'right',
       }
    }
}

        };

    // render init block
    const myChart1 = new Chart(
      document.getElementById('myChart1'),
      config2
    );

     function clickHandler(click) {
        const points = myChart.getElementsAtEventForMode(click,'nearest',{
            intersect:true},true);
        if (points.length) {
            console.log(points.length)
            console.log(points[0].element.$context.raw.sales);

        myChart1.config.data.datasets[0].data = points[0].element.$context.raw.sales;
        myChart1.update();
      }
    }
    ctx.onclick = clickHandler

									</script>
							</div>
					    </div><!--//app-card-->
				    </div><!--//col-->
			    </div><!--//row-->
			        
			        <div class="col-12">
				        <div class="app-card app-card-stats-table h-50 shadow-sm">
					        <div class="app-card-header p-3">
						        <div class="row justify-content-between align-items-center">
							        <div class="col-auto">
						                <h4 class="app-card-title">Stats List</h4>
							        </div><!--//col-->
							        <div class="col-auto">
								        <div class="card-header-action">
									        <a href="#">View report</a>
								        </div><!--//card-header-actions-->
							        </div><!--//col-->
						        </div><!--//row-->
					        </div><!--//app-card-header-->
					        <div class="app-card-body p-3 p-lg-4">
						        <div class="table-responsive">
							        <table class="table table-borderless mb-0">
										<thead>
											<tr>
												<th class="meta">Ticket Name</th>
												<th class="meta stat-cell">Quantity</th>
												<th class="meta stat-cell">Date</th>
												<th class="meta stat-cell">Price</th>
											</tr>
										</thead>
										<tbody>
											{% for i in users_list %}
												
											
											<tr>
												<td><a href="#">{{i.ticket_name}}</a></td>
												<td class="stat-cell">{{i.quantity}}</td>
												<td class="stat-cell">{{i.date}}</td>
												<td class="stat-cell">{{i.quantity * i.price}}</td>
											</tr>
											{% endfor %}

										</tbody>
									</table>
						        </div><!--//table-responsive-->
					        </div><!--//app-card-body-->
				        </div><!--//app-card-->
			        </div><!--//col-->		    
		    </div><!--//container-fluid-->
	    </div><!--//app-content-->
	</body>
{% endblock %}
